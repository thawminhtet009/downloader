<!doctype html>
<html lang="my">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Login + Token</title>
<style>
html,body{margin:0;padding:0;height:100%;font-family:'Poppins',sans-serif;}
body{display:flex;align-items:center;justify-content:center;background:radial-gradient(circle at top left,#0f172a,#1e293b 60%,#000);color:#f1f5f9;overflow:auto;position:relative;}
body::before,body::after{content:"";position:absolute;width:300px;height:300px;border-radius:50%;background:radial-gradient(circle,rgba(99,102,241,0.6),transparent 70%);animation:float 12s infinite ease-in-out alternate;z-index:-1;}
body::after{background:radial-gradient(circle,rgba(236,72,153,0.6),transparent 70%);top:40%;left:60%;animation-duration:18s;}
@keyframes float{from{transform:translateY(0) translateX(0);}to{transform:translateY(-20px) translateX(15px);}}

.card{width:90%;max-width:400px;padding:32px 24px;border-radius:20px;background:rgba(17,25,40,0.9);backdrop-filter:blur(20px) saturate(180%);border:1px solid rgba(255,255,255,0.1);box-shadow:0 8px 32px rgba(59,130,246,0.2);margin:20px auto;}
h1{margin:0 0 12px;font-size:24px;text-align:center;font-weight:700;background:linear-gradient(90deg,#60a5fa,#c084fc,#ec4899);-webkit-background-clip:text;-webkit-text-fill-color:transparent;animation:glow 2.5s ease-in-out infinite alternate;}
@keyframes glow{from{text-shadow:0 0 6px #60a5fa,0 0 12px #3b82f6;}to{text-shadow:0 0 8px #c084fc,0 0 16px #ec4899;}}
p{margin:0 0 20px;font-size:14px;text-align:center;color:#cbd5e1;line-height:1.5;}
input{width:100%;padding:16px;border-radius:12px;border:1px solid rgba(255,255,255,0.15);background:rgba(255,255,255,0.08);color:#f1f5f9;font-size:16px;outline:none;transition:0.3s;margin-bottom:16px;box-sizing:border-box;}
input:focus{border-color:#8b5cf6;box-shadow:0 0 10px #8b5cf6aa;}
button{width:100%;padding:16px;border-radius:12px;border:none;background:linear-gradient(90deg,#3b82f6,#8b5cf6,#ec4899);color:#fff;font-weight:600;font-size:16px;cursor:pointer;transition:transform 0.2s ease,box-shadow 0.2s ease;box-sizing:border-box;}
button:hover{transform:translateY(-2px) scale(1.02);box-shadow:0 0 14px rgba(236,72,153,0.6);}
button:active{transform:translateY(0) scale(0.98);}
.error,.ok{padding:10px;border-radius:10px;margin-top:16px;font-size:14px;text-align:center;}
.error{background:rgba(239,68,68,0.2);color:#fca5a5;border:1px solid rgba(239,68,68,0.3);}
.ok{background:rgba(34,197,94,0.2);color:#86efac;border:1px solid rgba(34,197,94,0.3);}
#feedback{min-height:20px;}

#access-denied{display:none;color:#fff;background:linear-gradient(135deg,#ff416c,#ff4b2b 80%);padding:32px 24px;text-align:center;font-weight:600;font-size:20px;border-radius:20px;margin:40px auto;max-width:90%;box-shadow:0 8px 32px rgba(255,65,108,0.18);position:relative;letter-spacing:0.5px;width:90%;}
#access-denied .icon{font-size:48px;display:block;margin-bottom:16px;animation:shake 0.7s cubic-bezier(.36,.07,.19,.97) both;}
#access-denied .desc{font-size:16px;opacity:0.95;margin-top:8px;line-height:1.5;}
@keyframes shake{10%,90%{transform:translateX(-2px);}20%,80%{transform:translateX(4px);}30%,50%,70%{transform:translateX(-6px);}40%,60%{transform:translateX(6px);}}

/* Responsive */
@media (max-width: 768px) {
  body::before, body::after {
    width: 200px;
    height: 200px;
  }
  body::before {
    top: 10%;
    left: 10%;
  }
  body::after {
    top: 50%;
    left: 70%;
    width: 180px;
    height: 180px;
  }
  
  .card {
    padding: 28px 20px;
    margin: 20px;
    max-width: 95%;
    border-radius: 16px;
  }
  
  h1 {
    font-size: 22px;
    margin-bottom: 10px;
  }
  
  p {
    font-size: 15px;
    margin-bottom: 18px;
  }
  
  input, button {
    padding: 18px;
    font-size: 16px;
    min-height: 52px;
    margin-bottom: 18px;
  }
  
  .error, .ok {
    font-size: 14px;
    padding: 12px;
    margin-top: 18px;
  }
  
  #access-denied {
    padding: 28px 20px;
    margin: 20px auto;
    font-size: 18px;
    max-width: 95%;
    border-radius: 16px;
  }
  
  #access-denied .icon {
    font-size: 40px;
    margin-bottom: 14px;
  }
  
  #access-denied .desc {
    font-size: 15px;
    line-height: 1.6;
  }
}

@media (max-width: 480px) {
  body {
    padding: 10px;
    align-items: flex-start;
    padding-top: 20px;
  }
  
  .card {
    padding: 24px 16px;
    margin: 10px;
    border-radius: 14px;
  }
  
  h1 {
    font-size: 20px;
  }
  
  p {
    font-size: 14px;
    margin-bottom: 16px;
  }
  
  input, button {
    padding: 16px;
    min-height: 48px;
  }
  
  #access-denied {
    padding: 24px 16px;
    margin: 10px auto;
    font-size: 16px;
    border-radius: 14px;
  }
  
  #access-denied .icon {
    font-size: 36px;
  }
  
  #access-denied .desc {
    font-size: 14px;
    line-height: 1.5;
  }
}

@media (min-width: 1200px) {
  .card {
    max-width: 420px;
    padding: 40px 32px;
  }
  
  h1 {
    font-size: 26px;
  }
  
  p {
    font-size: 15px;
  }
  
  input, button {
    padding: 18px;
    font-size: 16px;
  }
}

body.show-denied {
  align-items: flex-start;
  padding-top: 40px;
  justify-content: center;
}

body.show-denied #access-denied {
  margin: 20px auto;
  max-width: 90%;
}
</style>
</head>
<body>

<div class="card" id="login-card">
  <h1>üöÄ Download Access</h1>
  <p>Enter your code to unlock the link</p>
  <input id="codeInput" placeholder="Enter code..." autocomplete="off">
  <button id="submitBtn">Go To Link</button>
  <div id="feedback"></div>
</div>

<div id="access-denied">
  <span class="icon">‚ùå</span>
  <div class="desc">Access Denied or Session Expired.<br>
  Please visit via <span style="color:#ffe066;text-shadow:0 0 6px #fff">official link</span>.</div>
</div>

<script>
const SHEET_ID='1yFi2LC02KhBQZ4m6kfzad_1FBsom9QDABPUHS7RKOJM';
const SHEET_NAME='Sheet2';
const TOKEN='ouo123';
const EXPIRE_MINUTES=1;
let dataMap=null;

function showMsg(text,type){ 
  const fb=document.getElementById('feedback'); 
  fb.innerHTML=''; 
  if(!text) return; 
  const div=document.createElement('div'); 
  div.className=type; 
  div.textContent=text; 
  fb.appendChild(div); 
}

async function fetchSheet(){
  const url=`https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${encodeURIComponent(SHEET_NAME)}`;
  try{
    const res=await fetch(url); 
    const txt=await res.text();
    const jsonText=txt.substring(txt.indexOf('{'), txt.lastIndexOf('}')+1);
    const obj=JSON.parse(jsonText);
    const cols=obj.table.cols.map(c => (c.label||'').toLowerCase().trim());
    const rows=obj.table.rows||[];
    dataMap={};
    rows.forEach(r=>{
      const values=r.c.map(c=>c?c.v:'');
      const code=values[cols.indexOf('codes')]; 
      const link=values[cols.indexOf('link')];
      if(code) dataMap[code.trim()]=link.trim();
    });
  }catch(e){
    console.error(e);
  }
}

function setToken(code){ 
  const expireTime=Date.now()+EXPIRE_MINUTES*60*1000; 
  localStorage.setItem('access_code',code); 
  localStorage.setItem('access_code_expire',expireTime); 
}

function isTokenValid(){ 
  const stored=localStorage.getItem('access_code'); 
  const expire=localStorage.getItem('access_code_expire'); 
  if(!stored||!expire) return false; 
  if(Date.now()>parseInt(expire)) return false; 
  return true; 
}

function tryLogin(){ 
  const input=document.getElementById('codeInput').value.trim(); 
  if(!input){
    showMsg('‚ö†Ô∏è Please Enter Code','error');
    return;
  } 
  if(!dataMap){
    showMsg('üì° Sheet not loaded yet','error');
    return;
  } 
  const link=dataMap[input]; 
  if(link){ 
    setToken(input); 
    showMsg('‚úÖ Code correct... redirecting','ok'); 
    setTimeout(()=>window.location.href=link,900);
  } else{ 
    showMsg('‚ùå Invalid Code','error'); 
  } 
}

function showDenied(){ 
  document.getElementById('login-card').style.display='none'; 
  document.getElementById('access-denied').style.display='block'; 
  document.body.classList.add('show-denied');
}

document.getElementById('submitBtn').onclick=tryLogin;
document.getElementById('codeInput').addEventListener('keydown',e=>{
  if(e.key==='Enter') tryLogin();
});

fetchSheet().then(()=>{
  const urlParams=new URLSearchParams(window.location.search);
  const urlToken=urlParams.get('token');
  if(urlToken===TOKEN){ 
    setToken(urlToken); 
    if(history.replaceState){ 
      // ·Äñ·Äª·Ä±·Ä¨·ÄÄ·Ä∫·Äï·Ä±·Ä∏·Äô·Äö·Ä∫ token parameter ·ÄÄ·Ä≠·ÄØ URL ·Äô·Äæ·Ä¨
      const cleanUrl=window.location.protocol+"//"+window.location.host+window.location.pathname; 
      history.replaceState({}, document.title, cleanUrl); 
    } 
  }
  if(!isTokenValid()){ 
    showDenied(); 
  }
});
</script>

</body>
</html>
